### node_modules 那些需要了解的

场景: yarn.lock, 本文主要是由这个家伙开始的, 某月某日某项目代码线上出现了问题, 排查原因发现是因为lock文件被干掉了(不要关注为什么会被干掉), 然后就导致一些包默认升级了, 由于api没有兼容 程序就直接蹦掉了。

***我直接指定包版本号不行吗, 原来真的不行！！！你的包也会有依赖, 互相依赖就无法锁定版本***

> 看完本文后, 需要理清以下几个问题!

- package.json 配置?
- 执行 yarn 的时候到底发生了什么？
- yarn vs npm vs cnpm , yarn.lock package-lock?


***有人这样吐槽前端的开发者, 每天的工作不是在 yarn 就是在 yarn dev 然后 yarn build,但是事实上确实就是与node_modules 相关的一些命令确实会比较耗时。***

![直接上图](../assets/images/黑洞.png)

> 臭名昭著的 node_modules hell


#### node_modules 的设计

> 其实很多时候我们不关心过程, 比如我只要执行yarn的时候很快就能成功。 当然事实与预期不符合,然后就只看到命令行有个进度条好不容易快好的时候, 然后就卡在某个包那里, 然后仔细一看比较著名的代表就是: node-sass 嘿嘿, 当然了 如果网络不好, 你也会下载很长时间。


#### yarn 的时候到底发生了什么


#### package.json 的配置

> 这里说明的是比较重要的: key-value

```json
{
  // 对外暴露的引用的地址 
  "main": "index.js",
  // 书写的类型
  "types": "index.d.ts",
  // 我们对项目工程触发的基础命令 dev start build
  "scripts": {},
  "license": "",
  "devDependencies": {},
  "dependencies": {},
  "peerDependencies": {},  
}
```



#### 你用的是 yarn 关我 npm 什么事,嗯,cnpm？





参考文章:

1. [Ryan 对nodejs的10大遗憾](https://medium.com/@imior/10-things-i-regret-about-node-js-ryan-dahl-2ba71ff6b4dc)